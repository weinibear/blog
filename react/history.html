<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React 版本历史 | 我的</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="技术总结与分享">
    
    <link rel="preload" href="/assets/css/0.styles.928655d3.css" as="style"><link rel="preload" href="/assets/js/app.7663c34b.js" as="script"><link rel="preload" href="/assets/js/2.ad7e2b9b.js" as="script"><link rel="preload" href="/assets/js/1.cd2906e5.js" as="script"><link rel="preload" href="/assets/js/23.263efedb.js" as="script"><link rel="prefetch" href="/assets/js/10.f05445dd.js"><link rel="prefetch" href="/assets/js/11.27c1433b.js"><link rel="prefetch" href="/assets/js/12.a5b6f00e.js"><link rel="prefetch" href="/assets/js/13.7e00b0c7.js"><link rel="prefetch" href="/assets/js/14.7b8e9e1e.js"><link rel="prefetch" href="/assets/js/15.758d2d34.js"><link rel="prefetch" href="/assets/js/16.6630d05e.js"><link rel="prefetch" href="/assets/js/17.fc7304a2.js"><link rel="prefetch" href="/assets/js/18.3256f17f.js"><link rel="prefetch" href="/assets/js/19.74a914f9.js"><link rel="prefetch" href="/assets/js/20.b84bd26f.js"><link rel="prefetch" href="/assets/js/21.c8d33c9f.js"><link rel="prefetch" href="/assets/js/22.948ee8be.js"><link rel="prefetch" href="/assets/js/24.11aa9649.js"><link rel="prefetch" href="/assets/js/25.33efc096.js"><link rel="prefetch" href="/assets/js/26.05d4109f.js"><link rel="prefetch" href="/assets/js/27.ae696562.js"><link rel="prefetch" href="/assets/js/28.76a5c416.js"><link rel="prefetch" href="/assets/js/29.2e49b0f8.js"><link rel="prefetch" href="/assets/js/3.dbbd7a21.js"><link rel="prefetch" href="/assets/js/30.b5bedac3.js"><link rel="prefetch" href="/assets/js/31.21857129.js"><link rel="prefetch" href="/assets/js/32.0f676cb4.js"><link rel="prefetch" href="/assets/js/33.432dcb4a.js"><link rel="prefetch" href="/assets/js/34.f0137e54.js"><link rel="prefetch" href="/assets/js/35.1f26a716.js"><link rel="prefetch" href="/assets/js/36.c22c0d27.js"><link rel="prefetch" href="/assets/js/37.e877cf0e.js"><link rel="prefetch" href="/assets/js/38.b46b20bf.js"><link rel="prefetch" href="/assets/js/39.c43f7528.js"><link rel="prefetch" href="/assets/js/4.9499c5db.js"><link rel="prefetch" href="/assets/js/40.672d1f36.js"><link rel="prefetch" href="/assets/js/41.2c60918e.js"><link rel="prefetch" href="/assets/js/42.8094afdc.js"><link rel="prefetch" href="/assets/js/43.f283043b.js"><link rel="prefetch" href="/assets/js/44.3c0855b0.js"><link rel="prefetch" href="/assets/js/45.920b4022.js"><link rel="prefetch" href="/assets/js/46.778afc5f.js"><link rel="prefetch" href="/assets/js/47.5f80ade1.js"><link rel="prefetch" href="/assets/js/48.53bd22f3.js"><link rel="prefetch" href="/assets/js/49.2e257484.js"><link rel="prefetch" href="/assets/js/5.b99649db.js"><link rel="prefetch" href="/assets/js/50.ad546f30.js"><link rel="prefetch" href="/assets/js/51.4379d67f.js"><link rel="prefetch" href="/assets/js/52.a00272b0.js"><link rel="prefetch" href="/assets/js/53.73d6cecc.js"><link rel="prefetch" href="/assets/js/54.706028fa.js"><link rel="prefetch" href="/assets/js/55.9360b69e.js"><link rel="prefetch" href="/assets/js/56.87c4f09f.js"><link rel="prefetch" href="/assets/js/57.e9030aad.js"><link rel="prefetch" href="/assets/js/58.d56a34be.js"><link rel="prefetch" href="/assets/js/59.21154867.js"><link rel="prefetch" href="/assets/js/6.a57ff915.js"><link rel="prefetch" href="/assets/js/60.252a2a08.js"><link rel="prefetch" href="/assets/js/61.e8d9c1a1.js"><link rel="prefetch" href="/assets/js/62.fd702ad7.js"><link rel="prefetch" href="/assets/js/63.9b26263c.js"><link rel="prefetch" href="/assets/js/64.9cac04e7.js"><link rel="prefetch" href="/assets/js/65.5efc3bc2.js"><link rel="prefetch" href="/assets/js/66.fbe93229.js"><link rel="prefetch" href="/assets/js/67.9c825920.js"><link rel="prefetch" href="/assets/js/68.7bd4f4cb.js"><link rel="prefetch" href="/assets/js/69.8a72581e.js"><link rel="prefetch" href="/assets/js/7.3651ca16.js"><link rel="prefetch" href="/assets/js/70.db074d07.js"><link rel="prefetch" href="/assets/js/71.1a558be2.js"><link rel="prefetch" href="/assets/js/72.b012ab57.js"><link rel="prefetch" href="/assets/js/73.00285de9.js"><link rel="prefetch" href="/assets/js/74.e5fb9345.js"><link rel="prefetch" href="/assets/js/75.bdcf3d72.js"><link rel="prefetch" href="/assets/js/76.154e5ece.js"><link rel="prefetch" href="/assets/js/77.f9025a56.js"><link rel="prefetch" href="/assets/js/78.1ffd509e.js"><link rel="prefetch" href="/assets/js/79.f14b2752.js"><link rel="prefetch" href="/assets/js/80.47366232.js"><link rel="prefetch" href="/assets/js/81.5c998920.js"><link rel="prefetch" href="/assets/js/82.1a680328.js"><link rel="prefetch" href="/assets/js/83.12715e3c.js"><link rel="prefetch" href="/assets/js/84.11c88d64.js"><link rel="prefetch" href="/assets/js/85.7e829812.js"><link rel="prefetch" href="/assets/js/86.48391c52.js"><link rel="prefetch" href="/assets/js/87.69b12f9e.js"><link rel="prefetch" href="/assets/js/88.16d86467.js"><link rel="prefetch" href="/assets/js/89.43beef02.js"><link rel="prefetch" href="/assets/js/90.35a9e4d0.js"><link rel="prefetch" href="/assets/js/91.5b433221.js"><link rel="prefetch" href="/assets/js/92.19b71e04.js"><link rel="prefetch" href="/assets/js/93.06ceace1.js"><link rel="prefetch" href="/assets/js/94.8e996495.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5a4296f1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.928655d3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="我的" class="logo"> <span class="site-name can-hide">我的</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/react/introduce.html" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/js/" class="nav-link">
  Javascript
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/ts/" class="nav-link">
  Typescript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="移动端" class="dropdown-title"><span class="title">移动端</span> <span class="arrow down"></span></button> <button type="button" aria-label="移动端" class="mobile-dropdown-title"><span class="title">移动端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mini-program/" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/flutter/" class="nav-link">
  flutter
</a></li></ul></div></div><div class="nav-item"><a href="/browser/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工程化" class="dropdown-title"><span class="title">前端工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端工程化" class="mobile-dropdown-title"><span class="title">前端工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Backend" class="dropdown-title"><span class="title">Backend</span> <span class="arrow down"></span></button> <button type="button" aria-label="Backend" class="mobile-dropdown-title"><span class="title">Backend</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/go/" class="nav-link">
  go
</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">
  nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/network/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/database/" class="nav-link">
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/design-patterns/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/algorithms/" class="nav-link">
  数据结构和算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软件开发" class="dropdown-title"><span class="title">软件开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="软件开发" class="mobile-dropdown-title"><span class="title">软件开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/product/" class="nav-link">
  产品设计
</a></li><li class="dropdown-item"><!----> <a href="/project-management/" class="nav-link">
  项目管理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  linux
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="我的" class="dropdown-title"><span class="title">我的</span> <span class="arrow down"></span></button> <button type="button" aria-label="我的" class="mobile-dropdown-title"><span class="title">我的</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weinibear" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/todo/" class="nav-link">
  TODO
</a></li><li class="dropdown-item"><!----> <a href="/interview/" class="nav-link">
  知识点导航
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/react/introduce.html" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/js/" class="nav-link">
  Javascript
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/ts/" class="nav-link">
  Typescript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="移动端" class="dropdown-title"><span class="title">移动端</span> <span class="arrow down"></span></button> <button type="button" aria-label="移动端" class="mobile-dropdown-title"><span class="title">移动端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mini-program/" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/flutter/" class="nav-link">
  flutter
</a></li></ul></div></div><div class="nav-item"><a href="/browser/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工程化" class="dropdown-title"><span class="title">前端工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端工程化" class="mobile-dropdown-title"><span class="title">前端工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Backend" class="dropdown-title"><span class="title">Backend</span> <span class="arrow down"></span></button> <button type="button" aria-label="Backend" class="mobile-dropdown-title"><span class="title">Backend</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/go/" class="nav-link">
  go
</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">
  nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/network/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/database/" class="nav-link">
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/design-patterns/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/algorithms/" class="nav-link">
  数据结构和算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软件开发" class="dropdown-title"><span class="title">软件开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="软件开发" class="mobile-dropdown-title"><span class="title">软件开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/product/" class="nav-link">
  产品设计
</a></li><li class="dropdown-item"><!----> <a href="/project-management/" class="nav-link">
  项目管理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  linux
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="我的" class="dropdown-title"><span class="title">我的</span> <span class="arrow down"></span></button> <button type="button" aria-label="我的" class="mobile-dropdown-title"><span class="title">我的</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/weinibear" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/todo/" class="nav-link">
  TODO
</a></li><li class="dropdown-item"><!----> <a href="/interview/" class="nav-link">
  知识点导航
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/introduce.html" class="sidebar-link">介绍</a></li><li><a href="/react/build-own-react.html" class="sidebar-link">build-own-react</a></li><li><a href="/react/history.html" aria-current="page" class="active sidebar-link">React版本历史</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/history.html#_2017-9-26-v16-0" class="sidebar-link">2017-9-26[v16.0]</a></li><li class="sidebar-sub-header"><a href="/react/history.html#_2018-3-1" class="sidebar-link">2018-3-1</a></li><li class="sidebar-sub-header"><a href="/react/history.html#_2018-3-29-v16-3-0" class="sidebar-link">2018-3-29[v16.3.0]</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/history.html#新的-context-api" class="sidebar-link">新的 Context API</a></li><li class="sidebar-sub-header"><a href="/react/history.html#新的-createref-api" class="sidebar-link">新的 createRef API</a></li><li class="sidebar-sub-header"><a href="/react/history.html#新的-forwardref-api" class="sidebar-link">新的 forwardRef API</a></li><li class="sidebar-sub-header"><a href="/react/history.html#不安全的生命周期" class="sidebar-link">不安全的生命周期</a></li><li class="sidebar-sub-header"><a href="/react/history.html#两个新的生命周期" class="sidebar-link">两个新的生命周期</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/history.html#_2018-10-23-v16-6-0" class="sidebar-link">2018-10-23[v16.6.0]</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/history.html#react-memo" class="sidebar-link">React.memo</a></li><li class="sidebar-sub-header"><a href="/react/history.html#react-lazy-suspense" class="sidebar-link">React.lazy &amp;&amp; Suspense</a></li><li class="sidebar-sub-header"><a href="/react/history.html#static-contexttype" class="sidebar-link">static contextType</a></li><li class="sidebar-sub-header"><a href="/react/history.html#static-getderivedstatefromerror" class="sidebar-link">static getDerivedStateFromError</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/history.html#_2018-10-25-react-conf" class="sidebar-link">2018-10-25[React Conf]</a></li><li class="sidebar-sub-header"><a href="/react/history.html#_2019-2-6-v16-8-hooks-发布" class="sidebar-link">2019-2-6[v16.8] Hooks 发布</a></li><li class="sidebar-sub-header"><a href="/react/history.html#_2020-8-10-v17-0" class="sidebar-link">2020-8-10[v17.0]</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/history.html#更改了事件委托机制" class="sidebar-link">更改了事件委托机制</a></li><li class="sidebar-sub-header"><a href="/react/history.html#new-jsx-transform" class="sidebar-link">New JSX Transform</a></li><li class="sidebar-sub-header"><a href="/react/history.html#useeffect清理函数变为异步执行" class="sidebar-link">useEffect清理函数变为异步执行</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/history.html#_2022-3-29-v18-0" class="sidebar-link">2022-3-29[v18.0]</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/history.html#自动批量更新" class="sidebar-link">自动批量更新</a></li><li class="sidebar-sub-header"><a href="/react/history.html#并发特性-transitions" class="sidebar-link">并发特性 Transitions</a></li><li class="sidebar-sub-header"><a href="/react/history.html#并发特性-usedeferredvalue" class="sidebar-link">并发特性 useDeferredValue</a></li><li class="sidebar-sub-header"><a href="/react/history.html#new-suspense-features" class="sidebar-link">New Suspense Features</a></li><li class="sidebar-sub-header"><a href="/react/history.html#new-hooks" class="sidebar-link">New Hooks</a></li><li class="sidebar-sub-header"><a href="/react/history.html#new-client-and-server-rendering-apis" class="sidebar-link">New Client and Server Rendering APIs</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/history.html#版本历史总结" class="sidebar-link">版本历史总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/history.html#v15-及以前的老架构-stack-reconciler" class="sidebar-link">v15 及以前的老架构 Stack Reconciler</a></li><li class="sidebar-sub-header"><a href="/react/history.html#v16-及之后的新架构-fiber-reconciler" class="sidebar-link">v16 及之后的新架构 Fiber Reconciler</a></li><li class="sidebar-sub-header"><a href="/react/history.html#未开启并发更新-但添加新功能的-v18" class="sidebar-link">未开启并发更新,但添加新功能的 v18</a></li><li class="sidebar-sub-header"><a href="/react/history.html#开启了并发更新的-v18" class="sidebar-link">开启了并发更新的 v18</a></li></ul></li></ul></li><li><a href="/react/api.html" class="sidebar-link">Api介绍</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react-版本历史"><a href="#react-版本历史" class="header-anchor">#</a> React 版本历史</h1> <p>现在，React 的最新官方稳定版本已经到了<code>v18.2.0</code>，从 18 以后，多了许多新的特性，像<code>concurrency</code>，可能每隔一段时间，又会出现一些版本的升级，加入一些新的特性等。如果不了解 React 的变迁历史，面对这些不断更新的特性时，自然也无法知道 React 团队新增这些特性的真实原因，也无法真正做到正确地用好<code>React</code>。本文简短介绍下<code>React16</code>以来的一些重大更新，帮助更深层次理解 React。</p> <p>主要参考：<br> <a href="https://reactjs.org/blog/all.html" target="_blank" rel="noopener noreferrer">React 官方历史博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <a href="https://reactjs.org/blog/2022/03/29/react-v18.html" target="_blank" rel="noopener noreferrer">React v18.0<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <a href="https://juejin.cn/post/7094037148088664078#heading-23" target="_blank" rel="noopener noreferrer">React18 新特性解读<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <a href="https://mp.weixin.qq.com/s/tC2VF_uIZf4RfBWdlpaKUA" target="_blank" rel="noopener noreferrer">React 18 不再依赖 Concurrent Mode...<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_2017-9-26-v16-0"><a href="#_2017-9-26-v16-0" class="header-anchor">#</a> 2017-9-26[v16.0]</h2> <p>引入<code>fiber</code>，重写底层架构，为将来实现可中断的循环遍历更新方式添加支持</p> <h2 id="_2018-3-1"><a href="#_2018-3-1" class="header-anchor">#</a> 2018-3-1</h2> <p><strong>Async Rendering 要来了！！！</strong></p> <p><code>react</code>团队公开提到关于<code>react</code>已在准备异步渲染相关功能的改进。<a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html" target="_blank" rel="noopener noreferrer">Beyond React 16<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>这篇博客简单介绍了<code>Dan</code>老师在<code>JSConf 2018</code>上关于在用户设备计算能力和网络速度不同情况下，如何尽可能提高用户体验的探讨</p> <ul><li>针对用户设备计算能力的差别，<code>react</code>致力于设计一种方案，确保高优先级的更新不会被低优先级任务打断，称之为<code>time slicing时间切片</code>。同时浏览器提供的<code>requestIdleCallback</code>Api，在主线程空闲时执行回调，能够实现较好的用户体验。</li> <li>而针对用户网络情况的差异，<code>react</code>提出了在异步请求数据时的<code>suspend rendering</code>。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>可以看到，早在 2017 年<code>react16</code>时，<code>react</code>团队就已经开始<code>Async Rendering</code>的设计了，相关探讨可能更早。这样再来看近 5 年<code>react</code>的版本迭代历史，很多重要特性的发布，可以说就是在为更好过渡，完善到后来的<code>concurrency</code>来做准备的。</p></div> <h2 id="_2018-3-29-v16-3-0"><a href="#_2018-3-29-v16-3-0" class="header-anchor">#</a> 2018-3-29[v16.3.0]</h2> <h3 id="新的-context-api"><a href="#新的-context-api" class="header-anchor">#</a> 新的 Context API</h3> <h3 id="新的-createref-api"><a href="#新的-createref-api" class="header-anchor">#</a> 新的 createRef API</h3> <h3 id="新的-forwardref-api"><a href="#新的-forwardref-api" class="header-anchor">#</a> 新的 forwardRef API</h3> <h3 id="不安全的生命周期"><a href="#不安全的生命周期" class="header-anchor">#</a> 不安全的生命周期</h3> <p>由于<code>Async Rendering</code>在渲染过程中可能会出现多次中断，传统三个生命周期函数的执行可能会出现很多意想不到的结果。</p> <ul><li><code>componentWillMount</code></li> <li><code>componentWillReceiveProps</code></li> <li><code>componentWillUpdate</code></li></ul> <p><code>React v17</code>会将这些生命周期加上前缀<code>UNSAFE_</code></p> <h3 id="两个新的生命周期"><a href="#两个新的生命周期" class="header-anchor">#</a> 两个新的生命周期</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token function">getSnapshotBeforeUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_2018-10-23-v16-6-0"><a href="#_2018-10-23-v16-6-0" class="header-anchor">#</a> 2018-10-23[v16.6.0]</h2> <h3 id="react-memo"><a href="#react-memo" class="header-anchor">#</a> React.memo</h3> <p><code>Class component</code>解决子组件重复渲染问题，可以使用<code>PureComponent</code>和<code>shouldComponentUpdate</code>。</p> <p>对于<code>Function component</code>现在可以使用<code>React.memo</code></p> <h3 id="react-lazy-suspense"><a href="#react-lazy-suspense" class="header-anchor">#</a> React.lazy &amp;&amp; Suspense</h3> <p><a href="https://reactjs.org/docs/code-splitting.html#reactlazy" target="_blank" rel="noopener noreferrer">Code-Splitting<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> with Suspense</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> lazy<span class="token punctuation">,</span> Suspense <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> OtherComponent <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./OtherComponent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>OtherComponent <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>Code-Splitting</code>仅仅是<code>Suspense</code>的第一步，以后版本<code>Suspense</code>还会有更多功能，像<code>data fetching</code>等</p></div> <h3 id="static-contexttype"><a href="#static-contexttype" class="header-anchor">#</a> static contextType</h3> <p>用于<code>Class Component</code>中</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> contextType <span class="token operator">=</span> MyContext<span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span>
    <span class="token comment">/* perform a side-effect at mount using the value of MyContext */</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="static-getderivedstatefromerror"><a href="#static-getderivedstatefromerror" class="header-anchor">#</a> static getDerivedStateFromError</h3> <h2 id="_2018-10-25-react-conf"><a href="#_2018-10-25-react-conf" class="header-anchor">#</a> 2018-10-25[React Conf]</h2> <p><strong>discuss the latest in UI engineering.</strong></p> <ul><li>Hooks</li> <li>Suspense</li> <li>Concurrent Rendering</li></ul> <h2 id="_2019-2-6-v16-8-hooks-发布"><a href="#_2019-2-6-v16-8-hooks-发布" class="header-anchor">#</a> 2019-2-6[v16.8] Hooks 发布</h2> <h2 id="_2020-8-10-v17-0"><a href="#_2020-8-10-v17-0" class="header-anchor">#</a> 2020-8-10[v17.0]</h2> <p><code>React v17.0</code>过渡版本</p> <p><strong>“In particular, React 17 is a “stepping stone” release that makes it safer to embed a tree managed by one version of React inside a tree managed by a different version of React.”</strong></p> <h3 id="更改了事件委托机制"><a href="#更改了事件委托机制" class="header-anchor">#</a> 更改了事件委托机制</h3> <p><img src="https://reactjs.org/static/bb4b10114882a50090b8ff61b3c4d0fd/1e088/react_17_delegation.png" alt=""></p> <h3 id="new-jsx-transform"><a href="#new-jsx-transform" class="header-anchor">#</a> <code>New JSX Transform</code></h3> <p>项目中不需要引入 React 就可以使用 JSX</p> <p><strong>Old</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello World<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// --&gt;</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'Hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>New</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Inserted by a compiler (don't import it yourself!)</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> jsx <span class="token keyword">as</span> _jsx <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react/jsx-runtime'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello World<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// --&gt;</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">_jsx</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">'Hello world'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="useeffect清理函数变为异步执行"><a href="#useeffect清理函数变为异步执行" class="header-anchor">#</a> <code>useEffect</code>清理函数变为异步执行</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// effect</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Cleanup.</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_2022-3-29-v18-0"><a href="#_2022-3-29-v18-0" class="header-anchor">#</a> 2022-3-29[v18.0]</h2> <p>毫无疑问，<code>react v18</code>是<code>React</code>版本中无比重要的一个，但可能对于普通开发者开发方式并没有很明显的感觉，就像<code>react</code>团队所说，<br>
These updates are primarily aimed at maintainers of third-party libraries。<br>
When we design APIs, we try to hide implementation details from developers. As a React developer, you focus on what you want the user experience to look like, and React handles how to deliver that experience. So we don’t expect React developers to know how concurrency works under the hood。</p> <p><code>Concurrency</code>不算是一个特性，它是<code>react</code>底层实现的一个机制，其实从<code>react v16</code>开始，<code>react</code>团队就一直在为<code>Concurrency</code>做准备，像引入<code>fiber</code>, 重写整个架构，让可中断的循环更新代替不可中断的递归更新成为可能。</p> <h3 id="自动批量更新"><a href="#自动批量更新" class="header-anchor">#</a> 自动批量更新</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// React17时，只有在React合成事件中，才会被批量更新，其它像原生事件、setTimeout中都不会被批量处理</span>

<span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// React will only re-render once at the end (that's batching!)</span>
<span class="token punctuation">}</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// React will render twice, once for each state update (no batching)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>React v18</code>后，<code>createRoot</code>入口开始。不论是在<code>setTimeout</code>、<code>promises</code>、<code>native</code>、<code>event handlers</code>，还是其它
任何事件中，都会自动开启批量更新</p> <p>可以使用<code>flushSync</code>关闭批量更新</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> flushSync <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">flushSync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setCounter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// React has updated the DOM by now</span>
  <span class="token function">flushSync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// React has updated the DOM by now</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="并发特性-transitions"><a href="#并发特性-transitions" class="header-anchor">#</a> 并发特性 Transitions</h3> <p><code>transition</code>是<code>react</code>来区分紧急更新和非紧急更新的概念<br> <strong>Urgent updates</strong>，像用户的一些交互，输入、点击等<br> <strong>Transition updates</strong> 像一个页面向另一个页面视图的过渡</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> startTransition <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// 紧急更新，用户输入框输入</span>
<span class="token function">setInputValue</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 标记更新为一个transitions，非紧急更新</span>
<span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Transition: Show the results</span>
  <span class="token function">setSearchQuery</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>isPending<span class="token punctuation">,</span> startTransition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useTransition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="并发特性-usedeferredvalue"><a href="#并发特性-usedeferredvalue" class="header-anchor">#</a> 并发特性 useDeferredValue</h3> <p><strong>和 Transitions 思想类似，她是返回一个延迟响应的值，可以让一个 state 延迟生效，只有当前没有紧急更新时，该值才会变为最新值</strong></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useDeferredValue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> App<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>list<span class="token punctuation">,</span> setList<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Array</span></span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 使用了并发特性，开启并发更新</span>
  <span class="token keyword">const</span> deferredList <span class="token operator">=</span> <span class="token function">useDeferredValue</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>deferredList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>i<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><p>开启并发特性后 js 调用栈图示</p> <p><img src="/assets/img/concurrency-js-stack.4d06a016.png" alt=""></p> <p>我们的任务被拆分到每一帧不同的 task 中，JS 脚本执行时间大体在 5ms 左右，这样浏览器就有剩余时间执行样式布局和样式绘制，减少掉帧的可能性。<br>
这种将长任务分拆到每一帧中，像蚂蚁搬家一样一次执行一小段任务的操作，被称为<code>时间切片（time slice）</code></p> <p>如果不开启并发特性，此时由于组件数量繁多（10000 个），JS 执行时间为 500ms，也就是意味着，在没有并发特性的情况下：一次性渲染 10000 个标签的时候，页面会阻塞大约 0.5 秒，造成卡顿。</p> <h3 id="new-suspense-features"><a href="#new-suspense-features" class="header-anchor">#</a> New Suspense Features</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Spinner <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Comments <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span>
</code></pre></div><h3 id="new-hooks"><a href="#new-hooks" class="header-anchor">#</a> New Hooks</h3> <ul><li><code>useId</code></li> <li><code>useTransition</code></li> <li><code>useDeferredValue</code></li> <li><code>useSyncExternalStore</code></li> <li><code>useInsertionEffect</code></li></ul> <h3 id="new-client-and-server-rendering-apis"><a href="#new-client-and-server-rendering-apis" class="header-anchor">#</a> New Client and Server Rendering APIs</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// render --&gt; createRoot</span>
<span class="token comment">// React 17</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// React 18</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// React 17</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">unmountComponentAtNode</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// React 18</span>
root<span class="token punctuation">.</span><span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// React 17 render方法第三个参数回调函数</span>
<span class="token keyword">const</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> root<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'渲染完成'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// React 18 删除回调函数,可换成在useEffect中执行写法</span>
<span class="token keyword">const</span> <span class="token literal-property property">NewApp</span><span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'渲染完成'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>NewApp <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 在 React 17 的 FC 中，默认携带了 children 属性</span>
<span class="token keyword">interface</span> <span class="token class-name">MyComponentProps</span> <span class="token punctuation">{</span>
  color<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> MyComponent<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>MyComponentProps<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> MyComponent<span class="token punctuation">;</span>

<span class="token comment">// React 18 需要手动添加children属性声明</span>
<span class="token keyword">interface</span> <span class="token class-name">MyComponentProps</span> <span class="token punctuation">{</span>
  color<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  children<span class="token operator">?</span><span class="token operator">:</span> React<span class="token punctuation">.</span>ReactNode<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> MyComponent<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>MyComponentProps<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> MyComponent<span class="token punctuation">;</span>
</code></pre></div><p><strong>那在 react18 就是默认开启了并发特性吗，所有 react 开发者升级到 react18 就可以直接使用并发吗，答案是否定的，虽然 react18 使用 createRoot 入口函数，但是需要使用并发特性才能开启并发更新！！！</strong></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>关于普通开发者应怎样使用并发特性？<br> <code>react</code>团队的建议是，通过使用引入了并发特性的三方库或框架的形式，而不是直接使用像<code>startTransition</code>可以开启并发特性的 API</p> <p>However, long term, we expect the main way you’ll add concurrency to your app is by using a concurrent-enabled library or framework. In most cases, you won’t interact with concurrent APIs directly. For example, instead of developers calling startTransition whenever they navigate to a new screen, router libraries will automatically wrap navigations in startTransition.</p></div> <h2 id="版本历史总结"><a href="#版本历史总结" class="header-anchor">#</a> 版本历史总结</h2> <h3 id="v15-及以前的老架构-stack-reconciler"><a href="#v15-及以前的老架构-stack-reconciler" class="header-anchor">#</a> v15 及以前的老架构 Stack Reconciler</h3> <p>采用不可中断的递归方式更新</p> <h3 id="v16-及之后的新架构-fiber-reconciler"><a href="#v16-及之后的新架构-fiber-reconciler" class="header-anchor">#</a> v16 及之后的新架构 Fiber Reconciler</h3> <p><code>react16</code>开始，引入<code>fiber</code>，重写底层架构，更新是支持可中断的循环遍历更新方式，同时引入根据任务优先级调度更新的概念。但默认未开启并发更新，只是实现了底层机制。<code>react16</code>,<code>react17</code></p> <h3 id="未开启并发更新-但添加新功能的-v18"><a href="#未开启并发更新-但添加新功能的-v18" class="header-anchor">#</a> 未开启并发更新,但添加新功能的 v18</h3> <p>v18 默认启用了一些新功能，像<code>Automatic Batching</code>等，但不使用并发特性，就没有开启并发更新</p> <h3 id="开启了并发更新的-v18"><a href="#开启了并发更新的-v18" class="header-anchor">#</a> 开启了并发更新的 v18</h3> <p>使用像<code>useTransition</code>，<code>useDeferredValue</code>API 开启了并发特性，js 执行栈可以看到时间切片</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/react/build-own-react.html" class="prev">
        build-own-react
      </a></span> <span class="next"><a href="/react/api.html">
        Api介绍
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7663c34b.js" defer></script><script src="/assets/js/2.ad7e2b9b.js" defer></script><script src="/assets/js/1.cd2906e5.js" defer></script><script src="/assets/js/23.263efedb.js" defer></script>
  </body>
</html>
